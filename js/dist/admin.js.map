{"version":3,"file":"admin.js","mappings":"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","sources":["webpack://@ianm/log-viewer/webpack/bootstrap","webpack://@ianm/log-viewer/webpack/runtime/compat get default export","webpack://@ianm/log-viewer/webpack/runtime/define property getters","webpack://@ianm/log-viewer/webpack/runtime/hasOwnProperty shorthand","webpack://@ianm/log-viewer/webpack/runtime/make namespace object","webpack://@ianm/log-viewer/external root \"flarum.core.compat['admin/app']\"","webpack://@ianm/log-viewer/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@ianm/log-viewer/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@ianm/log-viewer/external root \"flarum.core.compat['admin/components/ExtensionPage']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/Component']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/components/Button']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/utils/humanTime']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@ianm/log-viewer/./src/admin/components/LogFileListItem.tsx","webpack://@ianm/log-viewer/./src/admin/components/LogFileList.tsx","webpack://@ianm/log-viewer/./src/admin/components/LogFileViewer.tsx","webpack://@ianm/log-viewer/./src/admin/state/LogFileState.ts","webpack://@ianm/log-viewer/./src/admin/components/LogViewerPage.tsx","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/Model']\"","webpack://@ianm/log-viewer/./src/admin/models/LogFile.ts","webpack://@ianm/log-viewer/./src/admin/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/app'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/components/ExtensionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/humanTime'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","import app from 'flarum/admin/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport humanTime from 'flarum/common/utils/humanTime';\nimport classList from 'flarum/common/utils/classList';\nimport icon from 'flarum/common/helpers/icon';\n\nexport default class LogFileListItem extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.file = this.attrs.file;\n    this.state = this.attrs.state;\n  }\n\n  view() {\n    const file = this.file;\n    const selected = this.state?.file?.data.id === file?.data.id;\n\n    return (\n      <div className=\"LogFile-item\">\n        <Button\n          className={classList('Button Button--logFile', { active: selected })}\n          onclick={() => {\n            this.setFile(file.fileName());\n          }}\n        >\n          <div>\n            <div className=\"fileName\">\n              {icon('far fa-file-alt')}\n              <code>{file.fileName()}</code>\n            </div>\n            <div className=\"fileDate\">\n              {app.translator.trans('ianm-log-viewer.admin.viewer.last_updated', {\n                updated: humanTime(file.modified()),\n              })}\n            </div>\n            <div className=\"fileInfo\">\n              {app.translator.trans('ianm-log-viewer.admin.viewer.file_size', {\n                size: file.size(),\n              })}\n            </div>\n          </div>\n        </Button>\n      </div>\n    );\n  }\n\n  setFile(fileName: string) {\n    this.state.loadLogFile(fileName);\n  }\n}\n","import app from 'flarum/admin/app';\nimport Component from 'flarum/common/Component';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport type Mithril from 'mithril';\nimport LogFileListItem from './LogFileListItem';\n\nexport default class LogFileList extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.loading = true;\n    this.files = [];\n\n    this.state = this.attrs.state;\n\n    this.refresh();\n  }\n\n  view() {\n    if (this.loading) {\n      return <LoadingIndicator />;\n    }\n\n    return (\n      <div className=\"LogViewerPage--fileListItems\">\n        {this.files.map((file) => {\n          return <LogFileListItem file={file} state={this.state} />;\n        })}\n      </div>\n    );\n  }\n\n  refresh(clear = true) {\n    if (clear) {\n      this.loading = true;\n      this.files = [];\n    }\n\n    return this.loadResults().then(this.parseResults.bind(this));\n  }\n\n  loadResults() {\n    return app.store.find('logs');\n  }\n\n  parseResults(results) {\n    this.files.push(...results);\n\n    this.loading = false;\n\n    m.redraw();\n    return results;\n  }\n}\n","import app from 'flarum/admin/app';\nimport Component from 'flarum/common/Component';\n\nexport default class LogFileViewer extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.state = this.attrs.state;\n  }\n\n  view() {\n    if (!this.state.getFile?.()) {\n      return (\n        <div className=\"LogViewerPage--No-File\">\n          <p>{app.translator.trans('ianm-log-viewer.admin.viewer.no_file_selected')}</p>\n        </div>\n      );\n    }\n\n    const file = this.state.getFile();\n    const content = file['data']['attributes']['content'];\n\n    return (\n      <div className=\"LogViewerPage--fileContent\">\n        <pre>{content}</pre>\n      </div>\n    );\n  }\n}\n","import app from 'flarum/admin/app';\n\nexport default class LogFileState {\n  constructor() {\n    this.file = null;\n  }\n\n  loadLogFile(filename: string) {\n    app\n      .request({\n        method: 'GET',\n        url: app.forum.attribute('apiUrl') + '/logs/' + filename,\n      })\n      .then((result) => {\n        this.file = result;\n        m.redraw();\n      });\n  }\n\n  getFile() {\n    return this.file;\n  }\n}\n","import app from 'flarum/admin/app';\nimport ExtensionPage from 'flarum/admin/components/ExtensionPage';\nimport LogFileList from './LogFileList';\nimport LogFileViewer from './LogFileViewer';\nimport LogFileState from '../state/LogFileState';\n\nexport default class LogViewerPage extends ExtensionPage {\n  content() {\n    const state = new LogFileState();\n\n    return (\n      <div className=\"container\">\n        <div className=\"LogViewerPage\">\n          <div className=\"LogViewerPage--fileList\">\n            <h3>{app.translator.trans('ianm-log-viewer.admin.viewer.available_logs_heading')}</h3>\n            <LogFileList state={state} />\n          </div>\n          <div className=\"LogViewerPage--container\">\n            <h3>{app.translator.trans('ianm-log-viewer.admin.viewer.file_contents_heading')}</h3>\n            {/* Note to self: would be nice to show the filename here? */}\n            <LogFileViewer className=\"LogViewerPage--fileContent\" state={state} />\n          </div>\n          <div className=\"LogViewerPage-settings\">\n            <div className=\"Form-group\">\n              {this.buildSettingComponent({\n                setting: 'ianm-log-viewer.purge-days',\n                type: 'number',\n                min: 0,\n                max: 365,\n                required: true,\n                label: app.translator.trans('ianm-log-viewer.admin.settings.purge-days'),\n                help: app.translator.trans('ianm-log-viewer.admin.settings.purge-days-help'),\n              })}\n              {this.submitButton()}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import Model from 'flarum/common/Model';\n\nexport default class LogFile extends Model {\n  fileName() {\n    return Model.attribute<string>('fileName').call(this);\n  }\n\n  fullPath() {\n    return Model.attribute<string>('fullPath').call(this);\n  }\n\n  size() {\n    return Model.attribute<number>('size').call(this);\n  }\n\n  modified() {\n    return Model.attribute('modified', Model.transformDate).call(this);\n  }\n\n  content() {\n    return Model.attribute<string | null>('content').call(this);\n  }\n}\n","import app from 'flarum/admin/app';\nimport LogViewerPage from './components/LogViewerPage';\nimport LogFile from './models/LogFile';\n\napp.initializers.add('ianm-log-viewer', () => {\n  app.store.models.logs = LogFile;\n\n  app.extensionData\n    .for('ianm-log-viewer')\n    .registerPermission(\n      {\n        icon: 'far fa-file-alt',\n        label: app.translator.trans('ianm-log-viewer.admin.permissions.access_logfile_api'),\n        permission: 'readLogfiles',\n      },\n      'view'\n    )\n    .registerPage(LogViewerPage);\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","LogFileListItem","oninit","vnode","this","file","attrs","state","view","selected","data","id","className","classList","active","onclick","setFile","fileName","icon","app","updated","humanTime","modified","size","loadLogFile","Component","LogFileList","loading","files","refresh","map","clear","loadResults","then","parseResults","results","push","m","redraw","LogFileViewer","getFile","content","LogFileState","filename","method","url","result","LogViewerPage","buildSettingComponent","setting","type","min","max","required","label","help","submitButton","ExtensionPage","LogFile","Model","fullPath","registerPermission","permission","registerPage"],"sourceRoot":""}