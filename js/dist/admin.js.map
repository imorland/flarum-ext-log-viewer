{"version":3,"file":"admin.js","mappings":"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","sources":["webpack://@ianm/log-viewer/webpack/bootstrap","webpack://@ianm/log-viewer/webpack/runtime/compat get default export","webpack://@ianm/log-viewer/webpack/runtime/define property getters","webpack://@ianm/log-viewer/webpack/runtime/hasOwnProperty shorthand","webpack://@ianm/log-viewer/webpack/runtime/make namespace object","webpack://@ianm/log-viewer/external root \"flarum.core.compat['admin/app']\"","webpack://@ianm/log-viewer/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@ianm/log-viewer/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@ianm/log-viewer/external root \"flarum.core.compat['admin/components/ExtensionPage']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/Component']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/components/Button']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/utils/humanTime']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@ianm/log-viewer/./src/admin/components/LogFileListItem.tsx","webpack://@ianm/log-viewer/./src/admin/components/LogFileList.tsx","webpack://@ianm/log-viewer/./src/admin/components/LogFileViewer.tsx","webpack://@ianm/log-viewer/./src/admin/state/LogFileState.ts","webpack://@ianm/log-viewer/./src/admin/components/LogViewerPage.tsx","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/Model']\"","webpack://@ianm/log-viewer/./src/admin/models/LogFile.ts","webpack://@ianm/log-viewer/./src/admin/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/app'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/components/ExtensionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/humanTime'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","import app from 'flarum/admin/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport humanTime from 'flarum/common/utils/humanTime';\nimport classList from 'flarum/common/utils/classList';\nimport icon from 'flarum/common/helpers/icon';\n\nexport default class LogFileListItem extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.file = this.attrs.file;\n    this.state = this.attrs.state;\n  }\n\n  view() {\n    const file = this.file;\n    const selected = this.state?.file?.data.id === file?.data.id;\n\n    return (\n      <div className=\"LogFile-item\">\n        <Button\n          className={classList('Button Button--logFile', { active: selected })}\n          onclick={() => {\n            this.setFile(file.fileName());\n          }}\n        >\n          <div>\n            <div className=\"fileName\">\n              {icon('far fa-file-alt')}\n              <code>{file.fileName()}</code>\n            </div>\n            <div className=\"fileDate\">\n              {app.translator.trans('ianm-log-viewer.admin.viewer.last_updated', {\n                updated: humanTime(file.modified()),\n              })}\n            </div>\n            <div className=\"fileInfo\">\n              {app.translator.trans('ianm-log-viewer.admin.viewer.file_size', {\n                size: file.size(),\n              })}\n            </div>\n          </div>\n        </Button>\n      </div>\n    );\n  }\n\n  setFile(fileName: string) {\n    this.state.loadLogFile(fileName);\n  }\n}\n","import app from 'flarum/admin/app';\nimport Component from 'flarum/common/Component';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport type Mithril from 'mithril';\nimport LogFileListItem from './LogFileListItem';\n\nexport default class LogFileList extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.loading = true;\n    this.files = [];\n\n    this.state = this.attrs.state;\n\n    this.refresh();\n  }\n\n  view() {\n    if (this.loading) {\n      return <LoadingIndicator />;\n    }\n\n    return (\n      <div className=\"LogViewerPage--fileListItems\">\n        {this.files.map((file) => {\n          return <LogFileListItem file={file} state={this.state} />;\n        })}\n      </div>\n    );\n  }\n\n  refresh(clear = true) {\n    if (clear) {\n      this.loading = true;\n      this.files = [];\n    }\n\n    return this.loadResults().then(this.parseResults.bind(this));\n  }\n\n  loadResults() {\n    return app.store.find('logs');\n  }\n\n  parseResults(results) {\n    this.files.push(...results);\n\n    this.loading = false;\n\n    m.redraw();\n    return results;\n  }\n}\n","import app from 'flarum/admin/app';\nimport Component from 'flarum/common/Component';\n\nexport default class LogFileViewer extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.state = this.attrs.state;\n  }\n\n  view() {\n    if (!this.state.getFile?.()) {\n      return (\n        <div className=\"LogViewerPage--No-File\">\n          <p>{app.translator.trans('ianm-log-viewer.admin.viewer.no_file_selected')}</p>\n        </div>\n      );\n    }\n\n    const file = this.state.getFile();\n    const content = file['data']['attributes']['content'];\n\n    return (\n      <div className=\"LogViewerPage--fileContent\">\n        <pre>{content}</pre>\n      </div>\n    );\n  }\n}\n","import app from 'flarum/admin/app';\n\nexport default class LogFileState {\n  constructor() {\n    this.file = null;\n  }\n\n  loadLogFile(filename: string) {\n    app\n      .request({\n        method: 'GET',\n        url: app.forum.attribute('apiUrl') + '/logs/' + filename,\n      })\n      .then((result) => {\n        this.file = result;\n        m.redraw();\n      });\n  }\n\n  getFile() {\n    return this.file;\n  }\n}\n","import app from 'flarum/admin/app';\nimport ExtensionPage from 'flarum/admin/components/ExtensionPage';\nimport LogFileList from './LogFileList';\nimport LogFileViewer from './LogFileViewer';\nimport LogFileState from '../state/LogFileState';\n\nexport default class LogViewerPage extends ExtensionPage {\n  content() {\n    const state = new LogFileState();\n\n    return (\n      <div className=\"container\">\n        <div className=\"LogViewerPage\">\n          <div className=\"LogViewerPage--fileList\">\n            <h3>{app.translator.trans('ianm-log-viewer.admin.viewer.available_logs_heading')}</h3>\n            <LogFileList state={state} />\n          </div>\n          <div className=\"LogViewerPage--container\">\n            <h3>{app.translator.trans('ianm-log-viewer.admin.viewer.file_contents_heading')}</h3>\n            {/* Note to self: would be nice to show the filename here? */}\n            <LogFileViewer className=\"LogViewerPage--fileContent\" state={state} />\n          </div>\n          <div className=\"LogViewerPage-settings\">\n            <div className=\"Form-group\">\n              {this.buildSettingComponent({\n                setting: 'ianm-log-viewer.purge-days',\n                type: 'number',\n                min: 0,\n                max: 365,\n                required: true,\n                label: app.translator.trans('ianm-log-viewer.admin.settings.purge-days'),\n                help: app.translator.trans('ianm-log-viewer.admin.settings.purge-days-help'),\n              })}\n              {this.submitButton()}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import Model from 'flarum/common/Model';\n\nexport default class LogFile extends Model {\n  fileName() {\n    return Model.attribute<string>('fileName').call(this);\n  }\n\n  fullPath() {\n    return Model.attribute<string>('fullPath').call(this);\n  }\n\n  size() {\n    return Model.attribute<number>('size').call(this);\n  }\n\n  modified() {\n    return Model.attribute('modified', Model.transformDate).call(this);\n  }\n\n  content() {\n    return Model.attribute<string | null>('content').call(this);\n  }\n}\n","import app from 'flarum/admin/app';\nimport LogViewerPage from './components/LogViewerPage';\nimport LogFile from './models/LogFile';\n\napp.initializers.add('ianm-log-viewer', () => {\n  app.store.models.logs = LogFile;\n\n  app.extensionData\n    .for('ianm-log-viewer')\n    .registerPermission(\n      {\n        icon: 'far fa-file-alt',\n        label: app.translator.trans('ianm-log-viewer.admin.permissions.access_logfile_api'),\n        permission: 'readLogfiles',\n      },\n      'view'\n    )\n    .registerPage(LogViewerPage);\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","LogFileListItem","_Component","apply","arguments","_proto","oninit","vnode","this","file","attrs","state","view","_this$state","_this","selected","data","id","m","className","Button","classList","active","onclick","setFile","fileName","icon","app","trans","updated","humanTime","modified","size","loadLogFile","Component","LogFileList","loading","files","refresh","LoadingIndicator","map","clear","loadResults","then","parseResults","find","results","_this$files","push","redraw","LogFileViewer","_this$state$getFile","getFile","content","LogFileState","filename","method","url","attribute","result","LogViewerPage","_ExtensionPage","buildSettingComponent","setting","type","min","max","required","label","help","submitButton","ExtensionPage","LogFile","_Model","Model","fullPath","add","models","logs","registerPermission","permission","registerPage"],"sourceRoot":""}