{"version":3,"file":"admin.js","mappings":"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","sources":["webpack://@ianm/log-viewer/./src/admin/components/LogFileList.tsx","webpack://@ianm/log-viewer/./src/admin/components/LogFileListItem.tsx","webpack://@ianm/log-viewer/./src/admin/components/LogFileViewer.tsx","webpack://@ianm/log-viewer/./src/admin/components/LogViewerPage.tsx","webpack://@ianm/log-viewer/./src/admin/index.ts","webpack://@ianm/log-viewer/./src/admin/models/LogFile.ts","webpack://@ianm/log-viewer/./src/admin/state/LogFileState.ts","webpack://@ianm/log-viewer/external root \"flarum.core.compat['admin/app']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['admin/components/ExtensionPage']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/Component']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/Model']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/components/Button']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@ianm/log-viewer/external root \"flarum.core.compat['common/utils/humanTime']\"","webpack://@ianm/log-viewer/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@ianm/log-viewer/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@ianm/log-viewer/webpack/bootstrap","webpack://@ianm/log-viewer/webpack/runtime/compat get default export","webpack://@ianm/log-viewer/webpack/runtime/define property getters","webpack://@ianm/log-viewer/webpack/runtime/hasOwnProperty shorthand","webpack://@ianm/log-viewer/webpack/runtime/make namespace object"],"sourcesContent":["import app from 'flarum/admin/app';\nimport Component from 'flarum/common/Component';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport type Mithril from 'mithril';\nimport LogFileListItem from './LogFileListItem';\n\nexport default class LogFileList extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.loading = true;\n    this.files = [];\n\n    this.state = this.attrs.state;\n\n    this.refresh();\n  }\n\n  view() {\n    if (this.loading) {\n      return <LoadingIndicator />;\n    }\n\n    return (\n      <div>\n        <div>\n          {this.files.map((file) => {\n            return <LogFileListItem file={file} state={this.state} />;\n          })}\n        </div>\n      </div>\n    );\n  }\n\n  refresh(clear = true) {\n    if (clear) {\n      this.loading = true;\n      this.files = [];\n    }\n\n    return this.loadResults().then(this.parseResults.bind(this));\n  }\n\n  loadResults() {\n    return app.store.find('logs');\n  }\n\n  parseResults(results) {\n    this.files.push(...results);\n\n    this.loading = false;\n\n    m.redraw();\n    return results;\n  }\n}\n","import app from 'flarum/admin/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport humanTime from 'flarum/common/utils/humanTime';\nimport icon from 'flarum/common/helpers/icon';\n\nexport default class LogFileListItem extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.file = this.attrs.file;\n    this.state = this.attrs.state;\n  }\n\n  view() {\n    const file = this.file;\n    return (\n      <div className=\"LogFile-item\">\n        <Button\n          className=\"Button Button--logFile\"\n          onclick={() => {\n            this.setFile(file.fileName());\n          }}\n        >\n          <div>\n            <div className=\"fileName\">\n              {icon('far fa-file-alt')}\n              <code>{file.fileName()}</code>\n            </div>\n            <div className=\"fileDate\">\n              {app.translator.trans('ianm-log-viewer.admin.viewer.last_updated', {\n                updated: humanTime(file.modified()),\n              })}\n            </div>\n            <div className=\"fileInfo\">\n              {app.translator.trans('ianm-log-viewer.admin.viewer.file_size', {\n                size: file.size(),\n              })}\n            </div>\n          </div>\n        </Button>\n      </div>\n    );\n  }\n\n  setFile(fileName: string) {\n    this.state.loadLogFile(fileName);\n  }\n}\n","import app from 'flarum/admin/app';\nimport Component from 'flarum/common/Component';\n\nexport default class LogFileViewer extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.state = this.attrs.state;\n  }\n\n  view() {\n    if (!this.state.getFile?.()) {\n      return (\n        <div className=\"LogViewerPage--No-File\">\n          <p>{app.translator.trans('ianm-log-viewer.admin.viewer.no_file_selected')}</p>\n        </div>\n      );\n    }\n\n    const file = this.state.getFile();\n    const content = file['data']['attributes']['content'];\n\n    return (\n      <div className=\"LogViewerPage--fileContent\">\n        {m.trust(content)}\n      </div>\n    );\n  }\n}\n","import app from 'flarum/admin/app';\nimport ExtensionPage from 'flarum/admin/components/ExtensionPage';\nimport LogFileList from './LogFileList';\nimport LogFileViewer from './LogFileViewer';\nimport LogFileState from '../state/LogFileState';\n\nexport default class LogViewerPage extends ExtensionPage {\n  content() {\n    const state = new LogFileState();\n\n    return (\n      <div className=\"container\">\n        <div className=\"LogViewerPage\">\n          <div className=\"LogViewerPage--fileList\">\n            <h3>{app.translator.trans('ianm-log-viewer.admin.viewer.available_logs_heading')}</h3>\n            <LogFileList state={state} />\n          </div>\n          <div className=\"LogViewerPage--container\">\n            <h3>{app.translator.trans('ianm-log-viewer.admin.viewer.file_contents_heading')}</h3>\n            {/* Note to self: would be nice to show the filename here? */}\n            <div>\n              <LogFileViewer className=\"LogViewerPage--fileContent\" state={state} />\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import app from 'flarum/admin/app';\nimport LogViewerPage from './components/LogViewerPage';\nimport LogFile from './models/LogFile';\n\napp.initializers.add('ianm-log-viewer', () => {\n  app.store.models.logs = LogFile;\n\n  app.extensionData\n    .for('ianm-log-viewer')\n    .registerPermission(\n      {\n        icon: 'far fa-file-alt',\n        label: app.translator.trans('ianm-log-viewer.admin.permissions.access_logfile_api'),\n        permission: 'readLogfiles',\n      },\n      'view'\n    )\n    .registerPage(LogViewerPage);\n});\n","import Model from 'flarum/common/Model';\n\nexport default class LogFile extends Model {\n  fileName() {\n    return Model.attribute<string>('fileName').call(this);\n  }\n\n  fullPath() {\n    return Model.attribute<string>('fullPath').call(this);\n  }\n\n  size() {\n    return Model.attribute<number>('size').call(this);\n  }\n\n  modified() {\n    return Model.attribute('modified', Model.transformDate).call(this);\n  }\n\n  content() {\n    return Model.attribute<string | null>('content').call(this);\n  }\n}\n","import app from 'flarum/admin/app';\n\nexport default class LogFileState {\n  constructor() {\n    this.file = null;\n  }\n\n  loadLogFile(filename: string) {\n    app\n      .request({\n        method: 'GET',\n        url: app.forum.attribute('apiUrl') + '/logs/' + filename,\n      })\n      .then((result) => {\n        this.file = result;\n        m.redraw();\n      });\n  }\n\n  getFile() {\n    return this.file;\n  }\n}\n","module.exports = flarum.core.compat['admin/app'];","module.exports = flarum.core.compat['admin/components/ExtensionPage'];","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/components/LoadingIndicator'];","module.exports = flarum.core.compat['common/helpers/icon'];","module.exports = flarum.core.compat['common/utils/humanTime'];","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"names":["app","Component","LoadingIndicator","LogFileListItem","LogFileList","oninit","vnode","loading","files","state","attrs","refresh","view","map","file","clear","loadResults","then","parseResults","bind","store","find","results","push","m","redraw","Button","humanTime","icon","setFile","fileName","translator","trans","updated","modified","size","loadLogFile","LogFileViewer","getFile","content","trust","ExtensionPage","LogFileState","LogViewerPage","LogFile","initializers","add","models","logs","extensionData","registerPermission","label","permission","registerPage","Model","attribute","call","fullPath","transformDate","filename","request","method","url","forum","result","setPrototypeOf","_inheritsLoose","subClass","superClass","prototype","Object","create","constructor","_setPrototypeOf","o","p","__proto__"],"sourceRoot":""}